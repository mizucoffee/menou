---
name: todo app
models: /models.rb
tests:
  - name: "[FILE] ファイルの存在確認"
    tasks:
      - type: file_exists
        files:
          - app.rb
          - models.rb
          - db/migrate/*_create_users.rb
          - db/migrate/*_create_tasks.rb
          - db/migrate/*_add_completed_and_so_on_to_tasks.rb
          - db/migrate/*_create_lists.rb
          - db/migrate/*_add_list_id_to_tasks.rb
          - views/_count_due.erb
          - views/edit.erb
          - views/index.erb
          - views/layout.erb
          - views/new.erb
          - views/sign_in.erb
          - views/sign_up.erb
  - name: "[DB] Schema検証"
    tasks:
      - type: db_schema
        table: lists
        expect:
          - name: name
            type: string
          - name: created_at
            type: datetime
            options:
              "null": false
          - name: updated_at
            type: datetime
            options:
              "null": false
      - type: db_schema
        table: tasks
        expect:
          - name: user_id
            type: integer
          - name: title
            type: string
          - name: completed
            type: boolean
          - name: due_date
            type: date
          - name: star
            type: boolean
          - name: list_id
            type: integer
            options:
              default: 1
          - name: created_at
            type: datetime
            options:
              "null": false
          - name: updated_at
            type: datetime
            options:
              "null": false
      - type: db_schema
        table: users
        expect:
          - name: name
            type: string
          - name: password_digest
            type: string
          - name: created_at
            type: datetime
            options:
              "null": false
          - name: updated_at
            type: datetime
            options:
              "null": false
  - name: "[HTTP] ルーティング検証"
    tasks:
      - type: http_get_status
        path: /
        expect: 200
      - type: http_get_status
        path: /signup
        expect: 200
      - type: http_get_status
        path: /signin
        expect: 200
      - type: http_get_status
        path: /signout
        expect: 302
      - type: http_get_status
        path: /tasks/new
        expect: 200
      - type: http_get_status
        path: /tasks/0/star
        expect: 500
      - type: http_get_status
        path: /tasks/0/edit
        expect: 500
      - type: http_get_status
        path: /tasks/over
        expect: 500
      - type: http_get_status
        path: /tasks/done
        expect: 500
  - name: "[HTTP] 未ログイン時はタスクが生成されない"
    tasks:
      - type: http_post_status
        path: /tasks
        body:
          due_date: "2030-01-01"
          list: プライベート
          title: タスク1
        expect: 303
      - type: db_select
        table: tasks
        where:
          title: タスク1
        expect: null
  - name: "[HTTP] アカウント生成"
    tasks:
      - type: http_post_status
        path: /signup
        expect: 303
        body:
          name: menou_user
          password: password
          password_confirm: password
      - type: db_where
        table: users
        where:
          id: 1
        expect:
          name: menou_user
  - name: "[HTTP] タスク生成 & ログイン確認"
    tasks:
      - type: http_post_status
        path: /tasks
        body:
          due_date: "2999-01-01"
          list: 1
          title: タスク1
        expect: 303
      - type: db_where
        table: tasks
        where:
          id: 1
        expect:
          due_date: "2999-01-01"
          list_id: 1
          title: タスク1
screenshots:
  - path: /
